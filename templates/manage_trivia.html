{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h2>Manage Trivia Questions</h2>
    
    <div class="row mt-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h3>Add New Question</h3>
                </div>
                <div class="card-body">
                    <form method="POST">
                        <div class="mb-3">
                            <label for="question" class="form-label">Question</label>
                            <textarea class="form-control" id="question" name="question" rows="3" required></textarea>
                        </div>
                        
                        <div class="mb-3">
                            <label for="options" class="form-label">Options (one per line, exactly 4 options)</label>
                            <textarea class="form-control" id="options" name="options" rows="4" required></textarea>
                        </div>
                        
                        <div class="mb-3">
                            <label for="correct_answer" class="form-label">Correct Answer</label>
                            <input type="text" class="form-control" id="correct_answer" name="correct_answer" required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="level" class="form-label">Level (1-15)</label>
                            <select class="form-control" id="level" name="level" required>
                                {% for level, prize in prize_money.items() %}
                                <option value="{{ level }}">Level {{ level }} - ${{ prize|format_number }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label for="category" class="form-label">Category</label>
                            <input type="text" class="form-control" id="category" name="category" required>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">Add Question</button>
                    </form>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h3>Existing Questions</h3>
                </div>
                <div class="card-body">
                    <div class="list-group">
                        {% for level in range(1, 16) %}
                        <div class="mb-4">
                            <h4>Level {{ level }} - ${{ prize_money[level]|format_number }}</h4>
                            {% for question in questions if question.level == level %}
                            <div class="list-group-item">
                                <h5 class="mb-1">{{ question.question_text }}</h5>
                                <p class="mb-1">
                                    <small class="text-muted">
                                        Category: {{ question.category }} | 
                                        Created: {{ question.created_at.strftime('%Y-%m-%d') }}
                                    </small>
                                </p>
                                <p class="mb-1">
                                    <strong>Correct Answer:</strong> {{ question.correct_answer }}
                                </p>
                                <div class="mt-2">
                                    <form action="{{ url_for('toggle_question', question_id=question.id) }}" method="POST" style="display: inline;">
                                        <button type="submit" class="btn btn-sm {% if question.is_active %}btn-warning{% else %}btn-success{% endif %}">
                                            {% if question.is_active %}Deactivate{% else %}Activate{% endif %}
                                        </button>
                                    </form>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% block scripts %}
<script>
document.getElementById('options').addEventListener('input', function() {
    const options = this.value.split('\n').filter(option => option.trim() !== '');
    const correctAnswer = document.getElementById('correct_answer');
    
    if (options.length > 0 && !options.includes(correctAnswer.value)) {
        correctAnswer.value = options[0];
    }
    
    // Validate exactly 4 options
    if (options.length !== 4) {
        this.setCustomValidity('Please enter exactly 4 options');
    } else {
        this.setCustomValidity('');
    }
});

document.getElementById('level').addEventListener('change', function() {
    const level = parseInt(this.value);
    const isSafeHaven = [5, 10, 15].includes(level);
    if (isSafeHaven) {
        alert('This is a safe haven level! Questions should be appropriately challenging.');
    }
});
</script>
{% endblock %}
{% endblock %} 